
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Generic Drug Predictions</title>

	<!-- Little icon at top -->
	<link rel="shortcut icon" href="/static/Banzaitokyo-Medico-Caduceus.ico">
		
	<!-- Bootstrap core CSS -->
	<link rel="stylesheet" type="text/css" href="/css/theme.css">
	<link rel="stylesheet" type="text/css" href="/css/bootstrap-theme.min.css">
	<link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="/css/nv.d3.css">
	<link rel="stylesheet" type="text/css" href="/css/styles.css">	  
  
	<script type="text/javascript" src="/js/bootstrap.js"> </script>
	<script type="text/javascript" src="/js/d3.v3.js"> </script>
	<script type="text/javascript" src="/js/nv.d3.js"> </script>
	<script type="text/javascript" src="/js/underscore.js"> </script>


    <!-- Bootstrap core CSS -->
    <!--<link href="http://getbootstrap.com/examples/theme/theme.css" rel="stylesheet">-->
    <!--<link href="http://getbootstrap.com/dist/css/bootstrap.min.css" rel="stylesheet">-->

    <!--&lt;!&ndash; Custom styles for this template &ndash;&gt;-->
    <!--<link href="http://getbootstrap.com/dist/css/bootstrap-theme.min.css" rel="stylesheet">-->
    <!--<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/nvd3/1.1.15-beta/nv.d3.css">-->

  </head>

  <body role = "document">

    <nav class="navbar navbar-inverse navbar-fixed-top">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="localhost:5000">The Data Incubator</a>
            </div>
            <div id="navbar" class="navbar-collapse collapse">
              <ul class="nav navbar-nav">
                <li><a href="/">Home</a></li>
                <li><a href="/background">Background</a></li>
                <li class="dropdown active">
                  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Gx Drug Models <span class="caret"></span></a>
                  <ul class="dropdown-menu">
                    <li class="active"><a href="/epcdose">Release vs. EPC</a></li>
                    <li><a href="/freq">Frequency Analysis</a></li>                    
                  </ul>
                </li>
                <li><a href="/presentation">Presentation</a></li>
                <li><a href="/contact">Contact</a></li>
              </ul>
            </div><!--/.nav-collapse -->
          </div>
        </nav>

    <div>

    </div>

    <div class="container theme-showcase" role="main">

      <h2><center><b>Predicting Brand-to-Generic Conversions</center></h2>
      <!-- <p>Pharmaceutical Model for Prediction</p> -->

      <div id="chart">
        <center>
        <svg style="height:450px">
        </svg>
      </center>
      </div>


      <script>

        // Mostly from: http://nvd3.org/examples/discreteBar.html
        function BindandRender(data) {

          // console.log("Properly formatted data")
          // console.log(data)

          nv.addGraph(function() {
            var chart = nv.models.scatterChart()
                          .showDistX(true)    //showDist, when true, will display those little distribution lines on the axis.
                          .showDistY(true)
                          .transitionDuration(350)
                          .forceY([-0.5,19])
                          .forceX([-0.5,19])
                          .showLegend(false)
                          .color(d3.scale.category10().range());

            //Configure how the tooltip looks.
            chart.tooltipContent(function(key) {
                var splitkey = key.split('; ')
                return '<h4>' + splitkey[0] + '</h4>' + '<h4>' + splitkey[1] + '</h4>';
            });

            //Axis settings
            chart.xAxis
              .tickFormat(d3.format('1.f'))
              .axisLabel('True: Years for Conversion');
            chart.yAxis
              .axisLabel('Predicted: Years for Conversion');
            
            console.log(d3.scale.category10().range())

            d3.select('#chart svg')
                .datum(data)
                .call(chart);

          
            nv.utils.windowResize(chart.update);

            return chart;

          });

        }

      function formatData(data) {

        formatteddata = []

        console.log(data.length)

        for (i=0; i < data.length; i++) {

          var groupname = "Brand Name: ".concat(data[i].bxname,"; Generic Name: ",data[i].gxname)

          formatteddata.push({            
            key: groupname,
            values: []
          })

          formatteddata[i].values.push({
            x: data[i].true, 
            y: data[i].predict, 
            size: 5, 
            shape: 'circle'
          })
        }

        return formatteddata;

      }

      var input = '{{ data }}'
      input = input.replace(/&#34;/g,'"')
      input_obj = JSON.parse(input)
      data_obj = formatData(input_obj)
      console.log(data_obj)
    
      BindandRender(data_obj)

    </script>

    <style>
      #chart svg { width: 80%; height: 40%;}
    </style>   


    </div><!-- /.container -->


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->

	<script type="text/javascript" src="/js/jquery.min.js"> </script>
	<script type="text/javascript" src="/js/bootstrap.min.js"> </script>

    
    
  </body>
</html>
